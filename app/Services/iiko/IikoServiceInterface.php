<?php

namespace App\Services\iiko;

use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;

class IikoServiceInterface
{
    /** @var IikoClient  */
    private IikoClient $iikoSmakiClient;

    /** @var IikoClient  */
    private IikoClient $iikoGoClient;

    /** @var DeliveryOrderService  */
    private DeliveryOrderService $deliveryOrderService;

    /** @var DeliveryOrderService  */
    private DeliveryService $deliveryService;

    /**
     * @param IikoServiceParser $iikoServiceParser
     */
    public function __construct(
        private IikoServiceParser $iikoServiceParser,
    ) {
        $this->iikoSmakiClient = new IikoClient(IikoClient::SMAKI);
        $this->iikoGoClient = new IikoClient(IikoClient::GO);

        $this->deliveryOrderService = new DeliveryOrderService();
        $this->deliveryService = new DeliveryService();
    }

    /**
     * @param string $courierIikoId
     * @param int $userId
     * @param string $orderUuid
     * @param array $validated
     * @return bool[]
     * @throws \Exception
     */
    public function setOrderDelivered(string $courierIikoId, int $userId, string $orderUuid, array $validated): array
    {
        $success = false;
        DB::beginTransaction();

        try {
//            switch ($validated['restaurant']) {
//                case IikoClient::SMAKI:
//                    $organizationId = IikoClient::ORGANIZATION_ID_SMAKI;
//                    $client = $this->iikoSmakiClient;
//                    break;
//                case IikoClient::GO:
//                    $organizationId = IikoClient::ORGANIZATION_ID_GO;
//                    $client = $this->iikoGoClient;
//                    break;
//                default:
//                    throw new InvalidArgumentException();
//            }
//
//            $response = Http::post(
//                IikoClient::API_URL . "/orders/set_order_delivered?access_token={$client->getAccessToken()}&organization={$organizationId}",
//                [
//                    'courierId' => $courierIikoId,
//                    'orderId' => $orderUuid,
//                    'delivered' => true,//$validated['delivered'],
//                    'actualDeliveryTime' => date('Y-m-d H:i:s'),
//                ]
//            );

            $this->deliveryOrderService->setAsDelivered($courierIikoId, $userId, $orderUuid, $validated);
            $success = true;
//            return $response->json();
        } catch (\Exception $e) {
            DB::rollBack();
            dd($e->getMessage());
            Log::error($e->getMessage());
            throw $e;
        }

        if ($success) {
            DB::commit();
        } else {
            DB::rollBack();
        }

        return [
            'success' => $success,
        ];
    }

    /**
     * @link https://docs.google.com/document/d/1pRQNIn46GH1LVqzBUY5TdIIUuSCOl-A_xeCBbogd2bE/edit#bookmark=kix.f85lxd2yapf1
     * @param string $courierIikoId
     * @return mixed
     * @throws \Exception
     */
    public function getCourierOrders(string $courierIikoId): mixed
    {
//        try {
//            $response = Http::get(IikoClient::API_URL . '/orders/get_courier_orders', [
//                'access_token' => $this->iikoSmakiClient->getAccessToken(),
//                'courier' => $courierIikoId,
//                'organization' => IikoClient::ORGANIZATION_ID_SMAKI
//            ]);
//dd($response->body());
//            $smakiOrders = $response->json();
//
//            $response = Http::get(IikoClient::API_URL . '/orders/get_courier_orders', [
//                'access_token' => $this->iikoGoClient->getAccessToken(),
//                'courier' => $courierIikoId,
//                'organization' => IikoClient::ORGANIZATION_ID_GO
//            ]);
//
//            $goOrders = $response->json();
//        } catch (\Exception $e) {
//            Log::error($e->getMessage());
//            throw $e;
//        }

        $smakiOrders = json_decode($this->smaki, true);
        $goOrders = json_decode($this->go, true);

        $existingOrdersInWork = $this->deliveryService->existingDeliveryForCourier($courierIikoId);

        return array_merge(
            $this->iikoServiceParser->parseDeliveryOrdersResponse($smakiOrders, $existingOrdersInWork),
            $this->iikoServiceParser->parseDeliveryOrdersResponse($goOrders, $existingOrdersInWork)
        );
    }

    private string $go = '{"INFO":"","deliveryOrders":[{"customer":{"sex":0,"id":"ce295b3e-eb22-4adb-bdec-5af9ee75b007","externalId":null,"name":"Владислава","surName":"","nick":"","comment":"","phone":"+380666639310","additionalPhones":[],"addresses":[],"cultureName":null,"birthday":null,"email":null,"middleName":null,"shouldReceivePromoActionsInfo":false,"counteragentInfo":null},"orderId":"49040721-963d-43f8-8bac-8df7f78e54ef","customerId":"ce295b3e-eb22-4adb-bdec-5af9ee75b007","movedDeliveryId":null,"customerName":"Владислава","customerPhone":null,"address":{"city":"Николаев","street":"Херсонское шоссе ","streetId":"018cf4d4-0e07-b00a-0173-044cb77e2445","streetClassifierId":null,"index":"","home":"28","housing":"","apartment":"","entrance":"2","floor":"","doorphone":"","comment":"","regionId":null,"externalCartographyId":""},"restaurantId":"dcc74ad6-ad40-11e9-80dd-d8d385655247","organization":"dcc74ad6-ad40-11e9-80dd-d8d385655247","sum":333.000000000,"discount":41.000000000,"number":"37756","status":"В пути","statusCode":"ON_WAY","deliveryCancelCause":null,"deliveryCancelComment":null,"courierInfo":{"courierId":"e715397f-3dbf-45a7-8974-4415b89adb5c","location":null},"orderLocationInfo":{"latitude":46.9582643,"longitude":32.048741},"deliveryDate":"2021-08-27 20:15:18","actualTime":"2021-08-27 20:06:45","billTime":"2021-08-27 19:57:28","cancelTime":null,"closeTime":"2021-08-27 20:06:46","confirmTime":"2021-08-27 19:17:21","createdTime":"2021-08-27 19:14:58","printTime":"2021-08-27 19:24:15","sendTime":"2021-08-27 19:57:28","comment":"","problem":null,"operator":{"id":"fe9e1dc0-5b05-481f-aa62-368c46a07b84","firstName":"Софія","middleName":null,"lastName":"Дерич","displayName":"Софія Дерич","phone":null,"cellPhone":null,"email":null,"code":"29278","pinCode":"","note":null,"mainRole":{"id":"f1733194-0fba-4efb-bd7e-63be063be1de","name":"Оператор","code":"О","paymentPerHour":0.000000000,"steadySalary":0.000000000,"comment":"","scheduleType":"BYSESSION","externalRevision":3746412,"deleted":false},"roles":[{"id":"f1733194-0fba-4efb-bd7e-63be063be1de","name":"Оператор","code":"О","paymentPerHour":0.000000000,"steadySalary":0.000000000,"comment":"","scheduleType":"BYSESSION","externalRevision":3746412,"deleted":false}],"deleted":false,"externalRevision":7757292},"conception":{"id":"850a7f60-dce2-4778-9d2b-62cec66e362b","name":"СГ Миколаїв","code":"31"},"marketingSource":{"id":"851bdd3d-a104-4965-b509-b8fdeceb1a8c","name":"Постійний кліент","attachedSources":[],"externalRevision":36032},"durationInMinutes":29,"personsCount":1,"splitBetweenPersons":false,"items":[{"id":"51678f86-5c08-4dea-b154-2ab86467508e","orderItemId":"00000000-0000-0000-0000-000000000000","code":"01291","name":"Сет Кілограм","category":null,"amount":1.000000000,"size":null,"modifiers":[],"sum":374.000000000,"comment":null,"guestId":"827f48df-b707-47bc-861d-7d88e0d2e752","comboInformation":null},{"id":"4e763b87-044c-4a1f-b0c2-e63213a7719e","orderItemId":"00000000-0000-0000-0000-000000000000","code":"00710","name":"Набір палички звичайні","category":null,"amount":3.000000000,"size":null,"modifiers":[],"sum":0.000000000,"comment":null,"guestId":"827f48df-b707-47bc-861d-7d88e0d2e752","comboInformation":null},{"id":"71e103a5-492e-402d-aacb-c894af326c99","orderItemId":"00000000-0000-0000-0000-000000000000","code":"01330","name":"Імбир","category":null,"amount":3.000000000,"size":null,"modifiers":[],"sum":0.000000000,"comment":null,"guestId":"827f48df-b707-47bc-861d-7d88e0d2e752","comboInformation":null}],"guests":[{"id":"827f48df-b707-47bc-861d-7d88e0d2e752","name":"Владислава"}],"payments":[{"sum":333.000000000,"paymentType":{"id":"9cd5d67a-89b4-ab69-1365-7b8c51865a90","code":"VISA","name":"Банковская карта","comment":"","combinable":true,"externalRevision":313347,"applicableMarketingCampaigns":null,"deleted":false},"additionalData":null,"isProcessedExternally":false,"isPreliminary":false,"isExternal":false,"chequeAdditionalInfo":null,"organizationDetailsInfo":null,"isFiscalizedExternally":false}],"orderType":{"id":"49cf98d2-25ab-d404-a5a8-11eaffc7ce7f","name":"Доставка курьером","orderServiceType":"DELIVERY_BY_COURIER","externalRevision":18},"deliveryTerminal":{"deliveryTerminalId":"a1ba47ff-82ea-e8e9-0179-e6a2404b7353","crmId":"1822129","restaurantName":"СГ Миколаїв","groupName":null,"externalRevision":11877406,"technicalInformation":null,"address":null,"protocolVersion":1},"discounts":[{"discountCardTypeId":"8566499f-d476-46e4-b57d-34b048513ace","discountCardSlip":null,"discountOrIncreaseSum":41.000000000}],"iikoCard5Coupon":null,"customData":null,"opinion":{"organization":null,"deliveryId":"49040721-963d-43f8-8bac-8df7f78e54ef","comment":null,"marks":[]},"referrerId":null},{"customer":{"sex":0,"id":"670b93fe-60ed-41d3-8d4d-9acf0de5298f","externalId":null,"name":"Юлія","surName":"","nick":"","comment":"","phone":"+380930204410","additionalPhones":[],"addresses":[],"cultureName":null,"birthday":null,"email":null,"middleName":null,"shouldReceivePromoActionsInfo":false,"counteragentInfo":null},"orderId":"2dfa4bc3-3060-4224-b9dd-2b8ebb48ca07","customerId":"670b93fe-60ed-41d3-8d4d-9acf0de5298f","movedDeliveryId":null,"customerName":"Юлія","customerPhone":null,"address":{"city":"Николаев","street":"Героев Украины просп.","streetId":"018cf4d4-0e07-b00a-0173-044cb77e230f","streetClassifierId":null,"index":"","home":"13г","housing":"","apartment":"","entrance":"3","floor":"","doorphone":"","comment":"на 21.00","regionId":null,"externalCartographyId":""},"restaurantId":"dcc74ad6-ad40-11e9-80dd-d8d385655247","organization":"dcc74ad6-ad40-11e9-80dd-d8d385655247","sum":335.000000000,"discount":342.000000000,"number":"52806","status":"В пути","statusCode":"ON_WAY","deliveryCancelCause":null,"deliveryCancelComment":null,"courierInfo":{"courierId":"43148589-5520-4be0-9e26-8fb98a1cb153","location":null},"orderLocationInfo":{"latitude":46.9928917,"longitude":31.9991292},"deliveryDate":"2021-08-27 21:00:59","actualTime":"2021-08-27 20:54:39","billTime":"2021-08-27 20:19:05","cancelTime":null,"closeTime":"2021-08-27 20:54:40","confirmTime":"2021-08-27 16:13:05","createdTime":"2021-08-27 16:10:59","printTime":"2021-08-27 19:42:00","sendTime":"2021-08-27 20:19:05","comment":"виграш","problem":null,"operator":{"id":"4a813163-1fac-4bd8-9b09-ab373d78cc25","firstName":"Світлана","middleName":null,"lastName":"Дюжикова","displayName":"Світлана Дюжикова СГ","phone":null,"cellPhone":null,"email":null,"code":"29270","pinCode":"","note":null,"mainRole":{"id":"f1733194-0fba-4efb-bd7e-63be063be1de","name":"Оператор","code":"О","paymentPerHour":0.000000000,"steadySalary":0.000000000,"comment":"","scheduleType":"BYSESSION","externalRevision":3746412,"deleted":false},"roles":[{"id":"f1733194-0fba-4efb-bd7e-63be063be1de","name":"Оператор","code":"О","paymentPerHour":0.000000000,"steadySalary":0.000000000,"comment":"","scheduleType":"BYSESSION","externalRevision":3746412,"deleted":false}],"deleted":false,"externalRevision":11382507},"conception":{"id":"850a7f60-dce2-4778-9d2b-62cec66e362b","name":"СГ Миколаїв","code":"31"},"marketingSource":{"id":"851bdd3d-a104-4965-b509-b8fdeceb1a8c","name":"Постійний кліент","attachedSources":[],"externalRevision":36032},"durationInMinutes":29,"personsCount":1,"splitBetweenPersons":false,"items":[{"id":"c9795450-7b6a-4d24-a51b-6ab14c1901fa","orderItemId":"00000000-0000-0000-0000-000000000000","code":"01381","name":"Сет 2+2","category":null,"amount":1.000000000,"size":null,"modifiers":[],"sum":335.000000000,"comment":null,"guestId":"224b239d-dc36-4716-8798-47ae1a58302a","comboInformation":null},{"id":"2488aa78-d001-4d6f-8f10-d900f6a9d75d","orderItemId":"00000000-0000-0000-0000-000000000000","code":"01198","name":"Лайт сет","category":null,"amount":1.000000000,"size":null,"modifiers":[],"sum":342.000000000,"comment":null,"guestId":"224b239d-dc36-4716-8798-47ae1a58302a","comboInformation":null},{"id":"4e763b87-044c-4a1f-b0c2-e63213a7719e","orderItemId":"00000000-0000-0000-0000-000000000000","code":"00710","name":"Набір палички звичайні","category":null,"amount":2.000000000,"size":null,"modifiers":[],"sum":0.000000000,"comment":null,"guestId":"224b239d-dc36-4716-8798-47ae1a58302a","comboInformation":null},{"id":"71e103a5-492e-402d-aacb-c894af326c99","orderItemId":"00000000-0000-0000-0000-000000000000","code":"01330","name":"Імбир","category":null,"amount":1.000000000,"size":null,"modifiers":[],"sum":0.000000000,"comment":null,"guestId":"224b239d-dc36-4716-8798-47ae1a58302a","comboInformation":null}],"guests":[{"id":"224b239d-dc36-4716-8798-47ae1a58302a","name":"Юлія"}],"payments":[{"sum":335.000000000,"paymentType":{"id":"9cd5d67a-89b4-ab69-1365-7b8c51865a90","code":"VISA","name":"Банковская карта","comment":"","combinable":true,"externalRevision":313347,"applicableMarketingCampaigns":null,"deleted":false},"additionalData":null,"isProcessedExternally":false,"isPreliminary":false,"isExternal":false,"chequeAdditionalInfo":null,"organizationDetailsInfo":null,"isFiscalizedExternally":false}],"orderType":{"id":"49cf98d2-25ab-d404-a5a8-11eaffc7ce7f","name":"Доставка курьером","orderServiceType":"DELIVERY_BY_COURIER","externalRevision":18},"deliveryTerminal":{"deliveryTerminalId":"a1ba47ff-82ea-e8e9-0179-e6a2404b7353","crmId":"1822129","restaurantName":"СГ Миколаїв","groupName":null,"externalRevision":11877406,"technicalInformation":null,"address":null,"protocolVersion":1},"discounts":[{"discountCardTypeId":"8566499f-d476-46e4-b57d-34b048513ace","discountCardSlip":null,"discountOrIncreaseSum":342.000000000}],"iikoCard5Coupon":null,"customData":null,"opinion":{"organization":null,"deliveryId":"2dfa4bc3-3060-4224-b9dd-2b8ebb48ca07","comment":null,"marks":[]},"referrerId":null}]}';
    private string $smaki = '{"INFO":"","deliveryOrders":[]}';
//    private string $smaki = '{"deliveryOrders":[{"customer":{"sex":0,"id":"279fabec-7b36-44f7-aa21-9df230cc90e3","externalId":null,"name":"Yurchenko A.","surName":"","nick":"","comment":"","phone":"+380683140125","additionalPhones":[],"addresses":[],"cultureName":null,"birthday":null,"email":null,"middleName":null,"shouldReceivePromoActionsInfo":false,"counteragentInfo":null},"orderId":"f100957b-01bb-4dd1-bc37-ca3fc8d1d7e3","customerId":"279fabec-7b36-44f7-aa21-9df230cc90e3","movedDeliveryId":null,"customerName":null,"customerPhone":null,"address":{"city":"Николаев","street":"Южная ул.","streetId":"018cf4d4-0e07-b00a-0173-044cb77e2458","streetClassifierId":null,"index":"","home":"31а","housing":"","apartment":"","entrance":"","floor":"","doorphone":"","comment":"глово","regionId":null,"externalCartographyId":""},"restaurantId":"f445683a-adf7-11e9-80dd-d8d385655247","organization":"f445683a-adf7-11e9-80dd-d8d385655247","sum":731.000000000,"discount":0.0,"number":"14021","status":"В пути","statusCode":"ON_WAY","deliveryCancelCause":null,"deliveryCancelComment":null,"courierInfo":{"courierId":"ed08213a-41cb-4bd5-ab80-e3a8791176b6","location":null},"orderLocationInfo":{"latitude":46.9463409,"longitude":32.0329108},"deliveryDate":"2021-08-27 11:31:51","actualTime":"2021-08-27 11:49:29","billTime":"2021-08-27 11:42:05","cancelTime":null,"closeTime":"2021-08-27 11:49:30","confirmTime":"2021-08-27 11:02:52","createdTime":"2021-08-27 11:01:37","printTime":"2021-08-27 11:03:14","sendTime":"2021-08-27 11:42:29","comment":"курєр +380 631 670 170","problem":null,"operator":{"id":"dab2929b-3733-480f-b0ef-b971b0e8eddc","firstName":"Юлія","middleName":null,"lastName":"Бакай","displayName":"Юлія Бакай","phone":null,"cellPhone":null,"email":null,"code":"28920","pinCode":"0415","note":null,"mainRole":{"id":"24cb0ced-ab84-4fdf-add0-032553434bae","name":"КЦ Оператор","code":"КЦО","paymentPerHour":0.000000000,"steadySalary":0.000000000,"comment":"","scheduleType":"BYSESSION","externalRevision":7739694,"deleted":false},"roles":[{"id":"24cb0ced-ab84-4fdf-add0-032553434bae","name":"КЦ Оператор","code":"КЦО","paymentPerHour":0.000000000,"steadySalary":0.000000000,"comment":"","scheduleType":"BYSESSION","externalRevision":7739694,"deleted":false}],"deleted":false,"externalRevision":26886046},"conception":{"id":"92ce52ae-4db8-4518-bbc4-da591ac50ef3","name":"Миколаїв","code":"16"},"marketingSource":{"id":"8415db1a-d1a4-4323-b7b2-03a0ce93e7cb","name":"Glovo","attachedSources":[],"externalRevision":23691733},"durationInMinutes":29,"personsCount":6,"splitBetweenPersons":false,"items":[{"id":"6d6b4ebf-ac40-4499-aad1-6bcfc8f8023a","orderItemId":"00000000-0000-0000-0000-000000000000","code":"01353","name":"Кілограм Преміум","category":null,"amount":1.000000000,"size":null,"modifiers":[],"sum":376.000000000,"comment":null,"guestId":"30b5876e-060d-4442-9466-e326fe3a82e3","comboInformation":null},{"id":"dba3c1c1-a6d0-4755-9a2f-d72215bfa83e","orderItemId":"00000000-0000-0000-0000-000000000000","code":"00208","name":"Сет МІХ","category":null,"amount":1.000000000,"size":null,"modifiers":[],"sum":355.000000000,"comment":null,"guestId":"30b5876e-060d-4442-9466-e326fe3a82e3","comboInformation":null},{"id":"f958621d-dff9-4730-a47a-1ad1914773db","orderItemId":"00000000-0000-0000-0000-000000000000","code":"00484","name":"Набір для персони навчальний","category":null,"amount":6.000000000,"size":null,"modifiers":[],"sum":0.000000000,"comment":null,"guestId":"30b5876e-060d-4442-9466-e326fe3a82e3","comboInformation":null},{"id":"89910246-2464-423a-9843-e6db71abdb08","orderItemId":"00000000-0000-0000-0000-000000000000","code":"01329","name":"Імбир","category":null,"amount":6.000000000,"size":null,"modifiers":[],"sum":0.000000000,"comment":null,"guestId":"30b5876e-060d-4442-9466-e326fe3a82e3","comboInformation":null}],"guests":[{"id":"30b5876e-060d-4442-9466-e326fe3a82e3","name":"Yurchenko A."}],"payments":[{"sum":731.000000000,"paymentType":{"id":"1ecad09e-ce78-4c25-8369-71d945440a90","code":"","name":"Glovo онлайн","comment":"","combinable":true,"externalRevision":23700421,"applicableMarketingCampaigns":null,"deleted":false},"additionalData":null,"isProcessedExternally":false,"isPreliminary":false,"isExternal":false,"chequeAdditionalInfo":null,"organizationDetailsInfo":null,"isFiscalizedExternally":false}],"orderType":{"id":"49cf98d2-25ab-d404-a5a8-11eaffc7ce7f","name":"Доставка курьером","orderServiceType":"DELIVERY_BY_COURIER","externalRevision":18},"deliveryTerminal":{"deliveryTerminalId":"018cf4d4-0e07-b00a-0172-e4f18ac4ce92","crmId":"1197047","restaurantName":"Миколаїв","groupName":null,"externalRevision":26805731,"technicalInformation":null,"address":null,"protocolVersion":1},"discounts":[],"iikoCard5Coupon":null,"customData":null,"opinion":{"organization":null,"deliveryId":"f100957b-01bb-4dd1-bc37-ca3fc8d1d7e3","comment":null,"marks":[]},"referrerId":null},{ "customer": { "sex": 0, "id": "72927f83-e332-4f5a-91fa-e808d504b01e", "externalId": null, "name": "Марян", "surName": "", "nick": "", "comment": "", "phone": "+380969587943", "additionalPhones": [], "addresses": [], "cultureName": null, "birthday": null, "email": null, "middleName": null, "shouldReceivePromoActionsInfo": true, "counteragentInfo": null }, "orderId": "c90e134c-c10b-b95b-231d-b9cc36a6c521", "customerId": "72927f83-e332-4f5a-91fa-e808d504b01e", "movedDeliveryId": null, "customerName": null, "customerPhone": null, "address": { "city": "Львів", "street": "Зелена вул.", "streetId": "5ae9f7f2-447d-6643-016e-4322595af38a", "streetClassifierId": null, "index": "", "home": "105", "housing": "", "apartment": "603", "entrance": "1", "floor": "6", "doorphone": "", "comment": "Львів, Зелена вул., дім 105, підїзд 1, поверх 6, квартира 603", "regionId": null, "externalCartographyId": "" }, "restaurantId": "f445683a-adf7-11e9-80dd-d8d385655247", "organization": "f445683a-adf7-11e9-80dd-d8d385655247", "sum": 555.000000000, "discount": 178.000000000, "number": "69425", "status": "В пути", "statusCode": "ON_WAY", "deliveryCancelCause": null, "deliveryCancelComment": null, "courierInfo": { "courierId": "5e495ed4-2436-4a22-8fd7-cacd1994de27", "location": { "latitude": 49.814977300, "longitude": 24.050396600, "accuracy": 3, "date": "2021-08-27 21:45:49" } }, "orderLocationInfo": { "latitude": 49.8248815, "longitude": 24.0502168 }, "deliveryDate": "2021-08-27 21:25:57", "actualTime": null, "billTime": "2021-08-27 21:29:37", "cancelTime": null, "closeTime": null, "confirmTime": "2021-08-27 20:56:35", "createdTime": "2021-08-27 20:55:57", "printTime": "2021-08-27 20:59:02", "sendTime": "2021-08-27 21:29:37", "comment": "Мобільний Додаток; | Можете не телефонувати мені для підтвердження замовлення | Доставка за 29хв; | Замовлення онлайн", "problem": null, "operator": { "id": "6246f2c7-1613-45f8-8eb2-f5e654b433af", "firstName": "Жанна", "middleName": null, "lastName": "Тарасюк", "displayName": "Жанна Тарасюк", "phone": null, "cellPhone": null, "email": null, "code": "29242", "pinCode": "", "note": null, "mainRole": { "id": "f1733194-0fba-4efb-bd7e-63be063be1de", "name": "Оператор", "code": "О", "paymentPerHour": 0.000000000, "steadySalary": 0.000000000, "comment": "", "scheduleType": "BYSESSION", "externalRevision": 7739694, "deleted": false }, "roles": [ { "id": "f1733194-0fba-4efb-bd7e-63be063be1de", "name": "Оператор", "code": "О", "paymentPerHour": 0.000000000, "steadySalary": 0.000000000, "comment": "", "scheduleType": "BYSESSION", "externalRevision": 7739694, "deleted": false } ], "deleted": false, "externalRevision": 26886046 }, "conception": { "id": "d3d5975b-9a64-49cb-9aed-eb580253c888", "name": "Садибна", "code": "5" }, "marketingSource": { "id": "851bdd3d-a104-4965-b509-b8fdeceb1a8c", "name": "Постійний кліент", "attachedSources": [], "externalRevision": 101112 }, "durationInMinutes": 29, "personsCount": 1, "splitBetweenPersons": false, "items": [ { "id": "597bd96c-4113-4fb3-a8a6-2a08e5b1bdc4", "orderItemId": "00000000-0000-0000-0000-000000000000", "code": "00133", "name": "Піца 4 М`яса 30 см", "category": null, "amount": 1.000000000, "size": null, "modifiers": [], "sum": 192.000000000, "comment": null, "guestId": "3b7376aa-1a2c-c054-017b-88b9ae9381b9", "comboInformation": null }, { "id": "538b9dd8-3738-4272-b4e0-7bfc608953af", "orderItemId": "00000000-0000-0000-0000-000000000000", "code": "00146", "name": "Піца Мілано 30 см", "category": null, "amount": 1.000000000, "size": null, "modifiers": [], "sum": 184.000000000, "comment": null, "guestId": "3b7376aa-1a2c-c054-017b-88b9ae9381b9", "comboInformation": null }, { "id": "6fd4cf71-a0be-4ab1-9f03-ed0c172a6745", "orderItemId": "00000000-0000-0000-0000-000000000000", "code": "01211", "name": "Піца Наполі 30 см", "category": null, "amount": 1.000000000, "size": null, "modifiers": [], "sum": 178.000000000, "comment": null, "guestId": "3b7376aa-1a2c-c054-017b-88b9ae9381b9", "comboInformation": null }, { "id": "858ffb22-01f3-4734-83b5-951497ef549a", "orderItemId": "00000000-0000-0000-0000-000000000000", "code": "00483", "name": "Набір до піци", "category": null, "amount": 1.000000000, "size": null, "modifiers": [], "sum": 0.000000000, "comment": null, "guestId": "3b7376aa-1a2c-c054-017b-88b9ae9381b9", "comboInformation": null }, { "id": "f6246cd5-80cd-4671-91db-b247daa0de18", "orderItemId": "00000000-0000-0000-0000-000000000000", "code": "00152", "name": "Піца Бургер 30 см", "category": null, "amount": 1.000000000, "size": null, "modifiers": [], "sum": 179.000000000, "comment": null, "guestId": "3b7376aa-1a2c-c054-017b-88b9ae9381b9", "comboInformation": null } ], "guests": [ { "id": "3b7376aa-1a2c-c054-017b-88b9ae9381b9", "name": "Марян" } ], "payments": [ { "sum": 530.000000000, "paymentType": { "id": "09322f46-578a-d210-add7-eec222a08871", "code": "CASH", "name": "Наличные", "comment": null, "combinable": true, "externalRevision": 18, "applicableMarketingCampaigns": null, "deleted": false }, "additionalData": null, "isProcessedExternally": false, "isPreliminary": true, "isExternal": false, "chequeAdditionalInfo": null, "organizationDetailsInfo": null, "isFiscalizedExternally": false }, { "sum": 25.000000000, "paymentType": { "id": "1b51a168-c8f2-46cd-95f9-4e124dd6b049", "code": "BALL", "name": "Оплата бонусами Smaki", "comment": "", "combinable": true, "externalRevision": 12664286, "applicableMarketingCampaigns": null, "deleted": false }, "additionalData": null, "isProcessedExternally": false, "isPreliminary": false, "isExternal": true, "chequeAdditionalInfo": null, "organizationDetailsInfo": null, "isFiscalizedExternally": false } ], "orderType": { "id": "49cf98d2-25ab-d404-a5a8-11eaffc7ce7f", "name": "Доставка курьером", "orderServiceType": "DELIVERY_BY_COURIER", "externalRevision": 18 }, "deliveryTerminal": { "deliveryTerminalId": "2ab6bd80-13d4-fde8-0174-1112e8815de6", "crmId": "793643", "restaurantName": "Садиба New", "groupName": null, "externalRevision": 28085698, "technicalInformation": null, "address": null, "protocolVersion": 1 }, "discounts": [ { "discountCardTypeId": "96799237-4e7a-9d4c-0178-15d148581ab5", "discountCardSlip": null, "discountOrIncreaseSum": 178.000000000 } ], "iikoCard5Coupon": null, "customData": null, "opinion": { "organization": null, "deliveryId": "c90e134c-c10b-b95b-231d-b9cc36a6c521", "comment": null, "marks": [] }, "referrerId": null },{"customer":{"sex":0,"id":"82f4e9dc-8411-4211-97a8-d2715585081d","externalId":null,"name":"Ірина","surName":"","nick":"","comment":"","phone":"+380953102027","additionalPhones":[],"addresses":[],"cultureName":null,"birthday":null,"email":null,"middleName":null,"shouldReceivePromoActionsInfo":true,"counteragentInfo":null},"orderId":"446cbc3d-325c-8bef-d629-0503ba247f40","customerId":"82f4e9dc-8411-4211-97a8-d2715585081d","movedDeliveryId":null,"customerName":"Ирина","customerPhone":null,"address":{"city":"Херсон","street":"Перекопская улица","streetId":"eb44ce49-4a6d-9daa-0175-2b5bc0893603","streetClassifierId":null,"index":"","home":"193а","housing":"","apartment":"134","entrance":"4","floor":"","doorphone":"","comment":"","regionId":null,"externalCartographyId":""},"restaurantId":"f445683a-adf7-11e9-80dd-d8d385655247","organization":"f445683a-adf7-11e9-80dd-d8d385655247","sum":264.000000000,"discount":0.0,"number":"34203","status":"Доставлена","statusCode":"DELIVERED","deliveryCancelCause":null,"deliveryCancelComment":null,"courierInfo":{"courierId":"0c42ac09-670c-4872-9303-8b5b2f2ca9f6","location":{"latitude":46.644340100,"longitude":32.592405200,"accuracy":52,"date":"2021-08-25 17:33:01"}},"orderLocationInfo":{"latitude":46.6651514,"longitude":32.6600438},"deliveryDate":"2021-07-03 21:58:00","actualTime":"2021-07-11 13:23:47","billTime":"2021-07-03 22:26:53","cancelTime":null,"closeTime":null,"confirmTime":"2021-07-03 21:31:55","createdTime":"2021-07-03 21:27:00","printTime":"2021-07-03 21:32:37","sendTime":"2021-07-03 22:26:53","comment":"Грибы заменить куриным филе ;","problem":null,"operator":{"id":"fe9e1dc0-5b05-481f-aa62-368c46a07b84","firstName":"Софія","middleName":null,"lastName":"Дерич","displayName":"Софія Дерич","phone":null,"cellPhone":null,"email":null,"code":"29278","pinCode":"","note":null,"mainRole":{"id":"f1733194-0fba-4efb-bd7e-63be063be1de","name":"Оператор","code":"О","paymentPerHour":0.000000000,"steadySalary":0.000000000,"comment":"","scheduleType":"BYSESSION","externalRevision":7739694,"deleted":false},"roles":[{"id":"f1733194-0fba-4efb-bd7e-63be063be1de","name":"Оператор","code":"О","paymentPerHour":0.000000000,"steadySalary":0.000000000,"comment":"","scheduleType":"BYSESSION","externalRevision":7739694,"deleted":false}],"deleted":false,"externalRevision":26886046},"conception":{"id":"faefe192-a871-4bd3-8217-db430db51047","name":"Херсон","code":"20"},"marketingSource":{"id":"b26b3206-2bd3-4c4d-941b-1286f89a85f0","name":"Сайт інтернет","attachedSources":[],"externalRevision":101112},"durationInMinutes":29,"personsCount":1,"splitBetweenPersons":false,"items":[{"id":"56b1f6a9-d61d-45be-9b80-e5ca7f0be15d","orderItemId":"00000000-0000-0000-0000-000000000000","code":"00485","name":"Набір для персони звичайний","category":null,"amount":2.000000000,"size":null,"modifiers":[],"sum":0.000000000,"comment":null,"guestId":"b88f3d59-3471-7f38-017a-6d9553258bdc","comboInformation":null},{"id":"6d2937a3-af5e-4983-90c0-51cf381fe78d","orderItemId":"00000000-0000-0000-0000-000000000000","code":"01262","name":"Акційний рол Каліфорнія хіт","category":null,"amount":1.000000000,"size":null,"modifiers":[],"sum":0.000000000,"comment":null,"guestId":"b88f3d59-3471-7f38-017a-6d9553258bdc","comboInformation":null},{"id":"b6f829e7-46b2-4f62-8fb6-2c225964aed9","orderItemId":"00000000-0000-0000-0000-000000000000","code":"00551","name":"Піца Ніжна 40 см","category":null,"amount":1.000000000,"size":null,"modifiers":[{"id":"87c04a51-5925-40f7-8aa8-faad8437a907","orderItemId":"00000000-0000-0000-0000-000000000000","name":"Курка смажена","amount":1.000000000,"groupName":null,"size":null,"comboInformation":null,"sum":0.0,"code":null,"category":null}],"sum":245.000000000,"comment":"Грибы заменить куриным филе ;","guestId":"b88f3d59-3471-7f38-017a-6d9553258bdc","comboInformation":null}],"guests":[{"id":"b88f3d59-3471-7f38-017a-6d9553258bdc","name":"Ирина"}],"payments":[{"sum":264.000000000,"paymentType":{"id":"09322f46-578a-d210-add7-eec222a08871","code":"CASH","name":"Наличные","comment":null,"combinable":true,"externalRevision":18,"applicableMarketingCampaigns":null,"deleted":false},"additionalData":null,"isProcessedExternally":false,"isPreliminary":true,"isExternal":false,"chequeAdditionalInfo":null,"organizationDetailsInfo":null,"isFiscalizedExternally":false}],"orderType":{"id":"49cf98d2-25ab-d404-a5a8-11eaffc7ce7f","name":"Доставка курьером","orderServiceType":"DELIVERY_BY_COURIER","externalRevision":18},"deliveryTerminal":{"deliveryTerminalId":"eb44ce49-4a6d-9daa-0175-5fee03e2aa18","crmId":"1394797","restaurantName":"Херсон","groupName":null,"externalRevision":27987055,"technicalInformation":null,"address":null,"protocolVersion":1},"discounts":[],"iikoCard5Coupon":null,"customData":null,"opinion":{"organization":null,"deliveryId":"446cbc3d-325c-8bef-d629-0503ba247f40","comment":null,"marks":[]},"referrerId":null}]}';
}
